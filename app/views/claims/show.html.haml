# coding: utf-8
-@title = "Первичная заявка"
%h2 Первичная заявка
.content
  %table.card
    %tr
      %th Номер
      %td= @claim.claim_number
    %tr  
      %th Направление
      %td= @claim.direction.short_name
    %tr  
      %th Отделение
      %td= @claim.branch_of_bank.name
    %tr  
      %th Статус
      %td= @claim.state.state_name.name
    %tr  
      %th Создана
      %td= @claim.create_date.to_date
  %table.data
    %tr
      %th Тип
      %th Название
      %th Количество
      %th Для кого
      %th Примечание
      %th 
      %th
    - for c_l in @claim.claim_lines.order(:id)
      %tr
        -#%td= c_l.ware.ware_type.short_name
        %td= c_l.asset.ware_type.short_name
        %td= (c_l.ware.asset_id ? c_l.ware.asset.name : c_l.ware.service.name )
        %td= c_l.count.to_s+' '+c_l.ware.unit.sign
        - w = Worker.select("lastname, firstname, soname, id_emp, staff").where("id_emp = ?", c_l.for_whom).first
        %td= w.lastname+' '+w.firstname[0,1]+'. '+w.soname[0,1]+'. '+w.staff
        %td= c_l.description
        %td= link_to "Удалить", :action => 'delete_claim_line', :claim_line_id => c_l.id
      
.action
  = link_to "Добавить строку", new_claim_line_path(:claim_id => @claim.id, :ware_type => 'asset')
  -#%br
  -#= link_to "Добавить услугу", new_claim_line_path(:claim_id => @claim.id, :ware_type => 'service')
  -#%br
  -#= link_to "Уточнить подразделение", :action => 'new'
  %br
  %br
  = link_to "На согласование", :action => 'claim_state_change', :id => @claim.id 
  -#= link_to "На согласование", :controller => 'claims_controller', :action => 'claim_state_change', :id => @claim.id